<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Distància entre Punt A i Punt B — Pitàgores pas a pas</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha384-sA+qGqQZ0g5m3m1kQqG7xv/Pw+f2k4s9V8R5cQZqJq3+e2Qf3g9y8m5z6aYb7c8b" crossorigin=""/>
  <style>
    :root{font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    body{margin:16px; background:#f7fafc; color:#0f172a}
    h1{font-size:1.4rem;margin:0 0 8px}
    .panel{display:grid;grid-template-columns:1fr 420px;gap:16px}
    #map{height:480px;border-radius:8px;border:1px solid rgba(2,6,23,0.08)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    button{background:#0369a1;color:white;border:none;padding:8px 10px;border-radius:6px;cursor:pointer}
    button.secondary{background:#64748b}
    .info{background:white;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(2,6,23,0.06)}
    .coord{display:flex;gap:6px;align-items:center;margin-bottom:6px}
    .coord input{width:180px;padding:6px;border:1px solid #e2e8f0;border-radius:6px}
    #steps{margin-top:8px;padding:10px;border-radius:6px;background:#0f172a;color:#e6eef8;min-height:160px;overflow:auto}
    canvas{width:100%;height:220px;border-radius:8px;background:#fff;margin-top:10px;border:1px solid rgba(2,6,23,0.06)}
    small.hint{color:#475569}
    footer{margin-top:12px;font-size:0.9rem;color:#475569}
    @media (max-width:980px){.panel{grid-template-columns:1fr}#map{height:360px}}
  </style>
  <!-- MathJax v3 config -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']
      },
      options: {
        skipHtmlTags: ['script','noscript','style','textarea','pre','code']
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
  <h1>Distància entre Punt A i Punt B — Pitàgores pas a pas</h1>
  <p class="hint">Feu servir el mapa per establir els punts o utilitzeu la vostra ubicació. El procés mostrarà pas a pas la conversió de graus a metres i aplicarà el teorema de Pitàgores amb MathJax.</p>

  <div class="controls">
    <button id="btnSetA">Posicionar A</button>
    <button id="btnSetB">Posicionar B</button>
    <button id="btnLocateA" class="secondary">Usa la meva ubicació per A</button>
    <button id="btnLocateB" class="secondary">Usa la meva ubicació per B</button>
    <button id="btnCompute">Calcula i mostra passos</button>
    <button id="btnReset" class="secondary">Reinicia</button>
  </div>

  <div class="panel">
    <div>
      <div id="map"></div>
    </div>

    <div class="info">
      <h2>Coordenades</h2>
      <div>
        <strong>Punt A</strong>
        <div class="coord">
          <label>Lat:</label>
          <input id="latA" readonly />
        </div>
        <div class="coord">
          <label>Lng:</label>
          <input id="lngA" readonly />
        </div>
      </div>

      <div style="margin-top:8px">
        <strong>Punt B</strong>
        <div class="coord">
          <label>Lat:</label>
          <input id="latB" readonly />
        </div>
        <div class="coord">
          <label>Lng:</label>
          <input id="lngB" readonly />
        </div>
      </div>

      <div id="steps" aria-live="polite">
        <em>Els passos s'hi mostraran quan hi hagi dos punts.</em>
      </div>

      <canvas id="sketch" width="600" height="300"></canvas>

      <footer>
        <small>R de la Terra usada: $R = 6\,371\,000\ \text{m}$. Conversió: radians $=\text{graus}\times\tfrac{\pi}{180}$.</small>
      </footer>
    </div>
  </div>

  <!-- Leaflet JS -->
  <scr
