<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>AprÃ¨n CatalÃ : Data i Hora</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, sans-serif; text-align: center; margin-top: 30px; 
            background: linear-gradient(to bottom, #f0f8ff, #e6f2ff); color: #333; }
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    h1 { color: #0066cc; margin-bottom: 25px; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
    #clock { width: 300px; height: 300px; border: 10px solid #333; border-radius: 50%;
             position: relative; margin: 0 auto 20px auto; background: white;
             box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
    .hand { position: absolute; top: 50%; left: 50%; transform-origin: 0% 50%;
             transform: rotate(-90deg); transition: transform 0.5s ease-in-out; }
    #hour-hand { width: 35%; height: 8px; background: #000; border-radius: 4px; }
    #minute-hand { width: 45%; height: 5px; background: red; border-radius: 3px; }
    #center-dot { width: 16px; height: 16px; background: #000; border-radius: 50%;
                  position: absolute; top: calc(50% - 8px); left: calc(50% - 8px); z-index: 10;
                  box-shadow: 0 0 5px rgba(0,0,0,0.5); }
    .number { position: absolute; width: 30px; height: 30px; text-align: center;
               line-height: 30px; font-weight: bold; transform: translate(-50%, -50%);
               color: #333; font-size: 16px; }
    #time-text, #date-text { 
      font-size: 1.5em; margin-top: 20px; min-height: 50px; padding: 15px;
      background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      color: #0066cc; font-weight: bold; 
    }
    #inputs { 
      margin-bottom: 30px; padding: 20px; background: white; 
      border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    input, button, select { 
      padding: 10px; margin: 8px; font-size: 1em; border: 2px solid #ccc;
      border-radius: 6px; transition: all 0.3s;
    }
    input:focus, select:focus { border-color: #0066cc; outline: none; }
    button { 
      background: #0066cc; color: white; cursor: pointer; 
      font-weight: bold; min-width: 120px;
    }
    button:hover { background: #0055aa; transform: translateY(-2px); }
    #voice-info { 
      margin-top: 15px; font-size: 0.9em; color: #555; padding: 10px;
      background: #f8f8f8; border-radius: 5px;
    }
    .instructions {
      margin-top: 30px; padding: 15px; background: #eef8ff; border-radius: 10px;
      text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .example { font-style: italic; color: #0066cc; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“š AprÃ¨n CatalÃ  amb la Data i l'Hora</h1>
    
    <div id="inputs">
      <button onclick="setNow()">Ara mateix</button><br>
      <input type="number" id="hour-input" min="0" max="23" placeholder="Hora (0â€“23)">
      <input type="number" id="minute-input" min="0" max="59" placeholder="Minut"><br>
      <input type="date" id="date-input"><br>
      <select id="day-select"></select>
      <select id="month-select"></select>
      <input type="number" id="year-input" min="1" max="3000" placeholder="Any"><br>
      <button onclick="setCustom()">Actualitza</button>
      <button onclick="speakAll()">ðŸ”Š Escolta</button>
    </div>
    
    <div id="clock">
      <div id="hour-hand" class="hand"></div>
      <div id="minute-hand" class="hand"></div>
      <div id="center-dot"></div>
    </div>
    
    <div id="date-text"></div>
    <div id="time-text"></div>
    <div id="voice-info">S'estan carregant les veus...</div>
    
    <div class="instructions">
      <h3>Instruccions:</h3>
      <p>Selecciona una data i hora per veure com es diuen en catalÃ .</p>
      <p>Prova amb anys diferents (ex: 1999, 1492, 1789) per veure com es llegeixen correctament.</p>
      <p class="example">Exemple: 1999 es llegeix "mil nou-cents noranta-nou"</p>
    </div>
  </div>

  <script>
    /* ------------------- ConfiguraciÃ³ TTS ------------------- */
    let voices = [];
    let hasCatalanVoice = false;
    let useResponsiveVoice = false;
    
    function loadResponsiveVoice() {
      return new Promise((resolve, reject) => {
        if (typeof responsiveVoice !== 'undefined') {
          resolve();
          return;
        }
        const script = document.createElement('script');
        script.src = 'https://code.responsivevoice.org/responsivevoice.js?key=HYPef5G5';
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }
    
    function loadVoices() {
      return new Promise((resolve) => {
        const synth = window.speechSynthesis;
        voices = synth.getVoices();
        
        if (voices.length !== 0) {
          checkCatalanVoices();
          resolve();
        } else {
          synth.onvoiceschanged = () => {
            voices = synth.getVoices();
            checkCatalanVoices();
            resolve();
          };
        }
      });
    }
    
    function checkCatalanVoices() {
      const synth = window.speechSynthesis;
      voices = synth.getVoices();
      hasCatalanVoice = voices.some(voice => voice.lang.includes('ca'));
      
      const voiceInfo = document.getElementById('voice-info');
      
      if (hasCatalanVoice) {
        voiceInfo.textContent = "S'ha detectat suport per a veu en catalÃ  al navegador.";
      } else {
        voiceInfo.textContent = "No s'ha detectat veu en catalÃ  al navegador. S'utilitzarÃ  un servei extern.";
        
        loadResponsiveVoice().then(() => {
          useResponsiveVoice = true;
          voiceInfo.textContent += ' Servei extern carregat correctament.';
        }).catch(() => {
          voiceInfo.textContent += ' Error en carregar el servei extern.';
        });
      }
    }
    
    window.addEventListener('DOMContentLoaded', () => {
      loadVoices();
    });

    /* ------------------- Rellotge ------------------- */
    const clock = document.getElementById('clock');
    const radius = 140;
    for (let i = 1; i <= 12; i++) {
      const angle = (i * 30 - 90) * Math.PI / 180;
      const x = 150 + radius * Math.cos(angle);
      const y = 150 + radius * Math.sin(angle);
      const number = document.createElement('div');
      number.className = 'number';
      number.innerText = i;
      number.style.left = `${x}px`;
      number.style.top = `${y}px`;
      clock.appendChild(number);
    }

    function numeroEnLletres(n) {
      return ['zero','un','dos','tres','quatre','cinc','sis','set','vuit','nou','deu','onze','dotze'][n];
    }
    
    function deHora(num) {
      const str = numeroEnLletres(num);
      return ['a','e','i','o','u'].includes(str[0]) ? `d'${str}` : `de ${str}`;
    }
    
    function prefixDia(h) {
      if (h >= 6 && h < 12) return 'del matÃ­';
      if (h >= 12 && h < 18) return 'de la tarda';
      if (h >= 18 && h < 22) return 'del vespre';
      return 'de la nit';
    }

    function horaAmbArticle(h) {
      if (h === 1) return "la " + numeroEnLletres(h);
      return "les " + numeroEnLletres(h);
    }

    function formatHoraCatalana(h, m) {
      const h12 = h % 12 || 12;
      const next = h12 % 12 + 1;
      const baseHora = horaAmbArticle(h12);
      const horaSeguent = horaAmbArticle(next);
      const dia = prefixDia(h);

      if (m === 0) return (h12 === 1 ? 'Ã‰s ' : 'SÃ³n ') + baseHora + ' en punt ' + dia;
      if (m === 15) return 'Ã‰s un quart ' + deHora(next) + ' ' + dia;
      if (m === 30) return 'SÃ³n dos quarts ' + deHora(next) + ' ' + dia;
      if (m === 45) return 'SÃ³n tres quarts ' + deHora(next) + ' ' + dia;

      if (m >= 7 && m <= 8) return 'Ã‰s mig quart ' + deHora(next) + ' ' + dia;
      if (m >= 22 && m <= 23) return 'Ã‰s un quart i mig ' + deHora(next) + ' ' + dia;
      if (m >= 37 && m <= 38) return 'SÃ³n dos quarts i mig ' + deHora(next) + ' ' + dia;
      if (m >= 52 && m <= 53) return 'SÃ³n tres quarts i mig ' + deHora(next) + ' ' + dia;

      const quarts = [
        { min: 15, text: 'un quart ' + deHora(next) },
        { min: 30, text: 'dos quarts ' + deHora(next) },
        { min: 45, text: 'tres quarts ' + deHora(next) },
        { min: 60, text: horaSeguent }
      ];

      let proper = quarts.find(q => m < q.min);
      let anterior = quarts[quarts.indexOf(proper) - 1] || { min: 0, text: baseHora };

      const diffNext = proper.min - m;
      const diffPrev = m - anterior.min;

      if (diffNext <= 5) {
        if (diffNext === 1) {
          return `Falta un minut per a ${proper.text} ${dia}`;
        } else {
          return `Falten ${numeroEnLletres(diffNext)} minuts per a ${proper.text} ${dia}`;
        }
      } else {
        if (diffPrev === 1) {
          return `Passa un minut de ${anterior.text} ${dia}`;
        } else {
          return `Passen ${numeroEnLletres(diffPrev)} minuts de ${anterior.text} ${dia}`;
        }
      }
    }

    function updateClock(h, m) {
      let h12 = h % 12 || 12;
      const hourAngle = ((h12 % 12) + m / 60) * 30 - 90;
      const minuteAngle = m * 6 - 90;
      document.getElementById('hour-hand').style.transform = `rotate(${hourAngle}deg)`;
      document.getElementById('minute-hand').style.transform = `rotate(${minuteAngle}deg)`;
      document.getElementById('time-text').innerText = formatHoraCatalana(h, m);
    }

    /* ------------------- Data ------------------- */
    const dies = ['diumenge','dilluns','dimarts','dimecres','dijous','divendres','dissabte'];
    const mesos = ['de gener','de febrer','de marÃ§','d\'abril','de maig','de juny','de juliol','d\'agost','de setembre','d\'octubre','de novembre','de desembre'];

    function numeroOrdinals(n) {
      const lletres = ['zero','un','dos','tres','quatre','cinc','sis','set','vuit','nou','deu',
        'onze','dotze','tretze','catorze','quinze','setze','disset','divuit','dinou','vint',
        'vint-i-un','vint-i-dos','vint-i-tres','vint-i-quatre','vint-i-cinc','vint-i-sis',
        'vint-i-set','vint-i-vuit','vint-i-nou','trenta','trenta-un'];
      return lletres[n];
    }

    function anyEnLletres(any) {
      if (any < 1000) {
        return numeroOrdinals(any);
      }

      let milers = Math.floor(any / 1000);
      let rest = any % 1000;

      let partMilers = '';
      if (milers === 1) {
        partMilers = 'mil';
      } else {
        partMilers = numeroOrdinals(milers) + ' mil';
      }

      if (rest === 0) {
        return partMilers;
      }

      let centenes = Math.floor(rest / 100);
      rest = rest % 100;

      let partCentenes = '';
      if (centenes > 0) {
        if (centenes === 1) {
          partCentenes = 'cent';
        } else {
          partCentenes = numeroOrdinals(centenes) + '-cents';
        }
      }

      let partResta = '';
      if (rest > 0) {
        partResta = rest < 31 ? numeroOrdinals(rest) : convertirNumero(rest);
      }

      let resultat = partMilers;
      if (partCentenes) {
        resultat += ' ' + partCentenes;
      }
      if (partResta) {
        resultat += ' ' + partResta;
      }

      return resultat;
    }

    function convertirNumero(n) {
      if (n <= 30) return numeroOrdinals(n);
      
      const desenes = Math.floor(n / 10);
      const unitats = n % 10;
      const nomsDesenes = ['', '', 'vint', 'trenta', 'quaranta', 'cinquanta', 'seixanta', 'setanta', 'vuitanta', 'noranta'];
      
      if (unitats === 0) {
        return nomsDesenes[desenes];
      } else {
        return nomsDesenes[desenes] + '-' + numeroOrdinals(unitats);
      }
    }

    function formatData(d) {
      const diaSetmana = dies[d.getDay()];
      const diaMes = d.getDate() < 31 ? numeroOrdinals(d.getDate()) : convertirNumero(d.getDate());
      const mes = mesos[d.getMonth()];
      const any = anyEnLletres(d.getFullYear());
      return `Avui Ã©s ${diaSetmana}, ${diaMes} ${mes} de l'any ${any}`;
    }

    /* ------------------- Control ------------------- */
    function setNow() {
      const now = new Date();
      now.setSeconds(0, 0); // âœ… forcem segons i ms a 0
      updateClock(now.getHours(), now.getMinutes());
      document.getElementById('date-text').innerText = formatData(now);
      
      document.getElementById('hour-input').value = now.getHours();
      document.getElementById('minute-input').value = now.getMinutes();
      document.getElementById('date-input').valueAsDate = now;
      document.getElementById('day-select').value = now.getDate();
      document.getElementById('month-select').value = now.getMonth();
      document.getElementById('year-input').value = now.getFullYear();
    }

    function setCustom() {
      const h = parseInt(document.getElementById('hour-input').value, 10);
      const m = parseInt(document.getElementById('minute-input').value, 10);
      const dateStr = document.getElementById('date-input').value;
      const daySel = parseInt(document.getElementById('day-select').value, 10);
      const monthSel = parseInt(document.getElementById('month-select').value, 10);
      const yearVal = parseInt(document.getElementById('year-input').value, 10);

      let d = null;

      if (dateStr) {
        d = new Date(dateStr);
      } else if (!isNaN(daySel) && !isNaN(monthSel) && !isNaN(yearVal)) {
        d = new Date(yearVal, monthSel, daySel);
      } else {
        d = new Date();
      }

      if (!isNaN(h)) d.setHours(h);
      if (!isNaN(m)) d.setMinutes(m, 0, 0); // âœ… ara segons i ms sempre a 0

      updateClock(d.getHours(), d.getMinutes());
      document.getElementById('date-text').innerText = formatData(d);
    }

    /* ------------------- Veu ------------------- */
    function speakAll() {
      const text = document.getElementById('date-text').innerText + ". " + document.getElementById('time-text').innerText;
      if (!text) return;
      
      if (useResponsiveVoice && typeof responsiveVoice !== 'undefined') {
        responsiveVoice.speak(text, "Catalan Female", {rate: 0.9});
      } else if (hasCatalanVoice) {
        const utterance = new SpeechSynthesisUtterance(text);
        const catalanVoice = voices.find(voice => voice.lang.includes('ca'));
        if (catalanVoice) {
          utterance.voice = catalanVoice;
        }
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utterance);
      } else {
        document.getElementById('voice-info').textContent = 
          'No s\'ha pogut carregar cap veu en catalÃ . Si us plau, actualitzeu el navegador.';
      }
    }

    /* ------------------- InicialitzaciÃ³ ------------------- */
    const daySelect = document.getElementById('day-select');
    for (let i = 1; i <= 31; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.text = i;
      daySelect.appendChild(option);
    }
    const monthSelect = document.getElementById('month-select');
    for (let i = 0; i < 12; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.text = mesos[i];
      monthSelect.appendChild(option);
    }
  </script>
</body>
</html>

