<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Rellotge i Data en Catal√†</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 20px;
    }
    #clock {
      width: 300px;
      height: 300px;
      border: 10px solid #333;
      border-radius: 50%;
      position: relative;
      margin: 20px auto;
      background: white;
    }
    .hand {
      position: absolute;
      top: 50%;
      left: 50%;
      transform-origin: 0% 50%;
      transform: rotate(-90deg);
      transition: transform 0.5s ease-in-out;
    }
    #hour-hand {
      width: 35%;
      height: 6px;
      background: #000;
    }
    #minute-hand {
      width: 45%;
      height: 4px;
      background: red;
    }
    #center-dot {
      width: 12px;
      height: 12px;
      background: #000;
      border-radius: 50%;
      position: absolute;
      top: calc(50% - 6px);
      left: calc(50% - 6px);
      z-index: 10;
    }
    .number {
      position: absolute;
      width: 30px;
      height: 30px;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      transform: translate(-50%, -50%);
    }
    #text {
      font-size: 1.2em;
      margin-top: 15px;
      min-height: 70px;
      white-space: pre-line;
    }
    #inputs {
      margin-bottom: 20px;
    }
    input, button, select {
      padding: 6px;
      margin: 4px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Apr√®n Catal√† amb Hora i Data</h1>

  <div id="inputs">
    <button onclick="setCurrent()">Ara mateix</button><br>
    <input type="number" id="hour" min="0" max="23" placeholder="Hora (0‚Äì23)">
    <input type="number" id="minute" min="0" max="59" placeholder="Minut"><br>
    <input type="number" id="day" min="1" max="31" placeholder="Dia">
    <select id="month">
      <option value="0">Gener</option>
      <option value="1">Febrer</option>
      <option value="2">Mar√ß</option>
      <option value="3">Abril</option>
      <option value="4">Maig</option>
      <option value="5">Juny</option>
      <option value="6">Juliol</option>
      <option value="7">Agost</option>
      <option value="8">Setembre</option>
      <option value="9">Octubre</option>
      <option value="10">Novembre</option>
      <option value="11">Desembre</option>
    </select>
    <input type="number" id="year" min="1900" max="2100" placeholder="Any"><br>
    <button onclick="setCustom()">Actualitza</button>
  </div>

  <div id="clock">
    <div id="hour-hand" class="hand"></div>
    <div id="minute-hand" class="hand"></div>
    <div id="center-dot"></div>
  </div>

  <div id="text"></div>
  <button onclick="speak()">üîä Escolta</button>

  <script>
    // ------------------------------
    // Dibuix del rellotge anal√≤gic
    // ------------------------------
    const clock = document.getElementById('clock');
    const radius = 140;

    for (let i = 1; i <= 12; i++) {
      const angle = (i * 30 - 90) * Math.PI / 180;
      const x = 150 + radius * Math.cos(angle);
      const y = 150 + radius * Math.sin(angle);
      const num = document.createElement('div');
      num.className = 'number';
      num.innerText = i;
      num.style.left = `${x}px`;
      num.style.top = `${y}px`;
      clock.appendChild(num);
    }

    // ------------------------------
    // Funcions auxiliars
    // ------------------------------
    function numeroEnLletres(n) {
      const noms = [
        'zero','una','dues','tres','quatre','cinc',
        'sis','set','vuit','nou','deu','onze','dotze'
      ];
      return noms[n] || n;
    }

    function deHora(num) {
      const str = numeroEnLletres(num);
      return ['a','e','i','o','u'].includes(str[0]) ? `d‚Äô${str}` : `de ${str}`;
    }

    function prefixDia(h) {
      if (h >= 6 && h < 12) return 'del mat√≠';
      if (h >= 12 && h < 18) return 'de la tarda';
      if (h >= 18 && h < 22) return 'del vespre';
      return 'de la nit';
    }

    const mesos = [
      'de gener','de febrer','de mar√ß','d‚Äôabril','de maig','de juny',
      'de juliol','d‚Äôagost','de setembre','d‚Äôoctubre','de novembre','de desembre'
    ];

    const diesSetmana = [
      'diumenge','dilluns','dimarts','dimecres','dijous','divendres','dissabte'
    ];

    function numeroAnyLletres(num) {
      return num.toString().split('').map(d =>
        ['zero','un','dos','tres','quatre','cinc','sis','set','vuit','nou'][parseInt(d)]
      ).join(' ');
    }

    // ------------------------------
    // Format hora catalana
    // ------------------------------
    function formatHoraCatalana(h, m) {
      const h12 = h % 12 || 12;
      const next = h12 % 12 + 1;
      const baseHora = numeroEnLletres(h12);
      const horaSeguent = numeroEnLletres(next);
      const dia = prefixDia(h);

      // Casos exactes
      if (m === 0) return (h12 === 1 ? '√âs la ' : 'S√≥n les ') + baseHora + ' en punt ' + dia;
      if (m === 15) return '√âs un quart ' + deHora(next) + ' ' + dia;
      if (m === 30) return 'S√≥n dos quarts ' + deHora(next) + ' ' + dia;
      if (m === 45) return 'S√≥n tres quarts ' + deHora(next) + ' ' + dia;

      // Mig quarts
      if (m >= 7 && m <= 8) return '√âs mig quart ' + deHora(next) + ' ' + dia;
      if (m >= 22 && m <= 23) return '√âs un quart i mig ' + deHora(next) + ' ' + dia;
      if (m >= 37 && m <= 38) return 'S√≥n dos quarts i mig ' + deHora(next) + ' ' + dia;
      if (m >= 52 && m <= 53) return 'S√≥n tres quarts i mig ' + deHora(next) + ' ' + dia;

      // Passen / falten
      const quarts = [
        { min: 15, text: 'un quart ' + deHora(next) },
        { min: 30, text: 'dos quarts ' + deHora(next) },
        { min: 45, text: 'tres quarts ' + deHora(next) },
        { min: 60, text: 'les ' + horaSeguent }
      ];

      let proper = quarts.find(q => m < q.min);
      let anterior = quarts[quarts.indexOf(proper) - 1] || { min: 0, text: baseHora };

      const diffNext = proper.min - m;
      const diffPrev = m - anterior.min;

      if (diffNext <= 5) {
        return `Falten ${diffNext} minut${diffNext===1?'':'s'} per a ${proper.text} ${dia}`;
      } else {
        return `Passen ${diffPrev} minut${diffPrev===1?'':'s'} de ${anterior.text} ${dia}`;
      }
    }

    // ------------------------------
    // Actualitzaci√≥ rellotge i text
    // ------------------------------
    function update(h, m, d, mo, y) {
      const h12 = h % 12 || 12;

      // Moure manetes
      document.getElementById('hour-hand').style.transform =
        `rotate(${((h12 % 12) + m/60) * 30 - 90}deg)`;
      document.getElementById('minute-hand').style.transform =
        `rotate(${m * 6 - 90}deg)`;

      // Text amb dia i hora
      const diaSetmana = diesSetmana[new Date(y, mo, d).getDay()];
      const text = `${diaSetmana}, ${numeroEnLletres(d)} ${mesos[mo]} de l‚Äôany ${numeroAnyLletres(y)}.\n` +
                   formatHoraCatalana(h, m);

      document.getElementById('text').innerText = text;
      return text;
    }

    function setCurrent() {
      const now = new Date();
      return update(
        now.getHours(),
        now.getMinutes(),
        now.getDate(),
        now.getMonth(),
        now.getFullYear()
      );
    }

    function setCustom() {
      const h = parseInt(document.getElementById('hour').value);
      const m = parseInt(document.getElementById('minute').value);
      const d = parseInt(document.getElementById('day').value);
      const mo = parseInt(document.getElementById('month').value);
      const y = parseInt(document.getElementById('year').value);

      if ([h,m,d,mo,y].some(isNaN)) {
        alert("Completa tots els camps!");
        return;
      }
      update(h, m, d, mo, y);
    }

    // ------------------------------
    // S√≠ntesi de veu
    // ------------------------------
    let selectedVoice = null;

    function loadVoices() {
      const voices = speechSynthesis.getVoices();

      // Busca veu catalana
      selectedVoice = voices.find(v => v.lang.startsWith("ca"));

      // Si no hi ha, reserva en castell√†
      if (!selectedVoice) {
        selectedVoice = voices.find(v => v.lang.startsWith("es"));
        alert("‚ö†Ô∏è No s‚Äôha trobat veu catalana al teu sistema. Es far√† servir castell√† com a alternativa.");
      }
    }

    // Quan es carreguen veus
    speechSynthesis.onvoiceschanged = loadVoices;

    function speak() {
      const text = document.getElementById('text').innerText;
      if (!selectedVoice) loadVoices();
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = selectedVoice.lang;
      utter.voice = selectedVoice;
      speechSynthesis.speak(utter);
    }

    // ------------------------------
    // Inicialitzaci√≥
    // ------------------------------
    setCurrent();
    const now = new Date();
    setTimeout(() => {
      setCurrent();
      setInterval(setCurrent, 60*1000);
    }, (60 - now.getSeconds()) * 1000);
  </script>
</body>
</html>

