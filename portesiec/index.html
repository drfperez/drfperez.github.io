
<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Simulador de portes l√≤giques IEC DIN</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #eef2f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 40px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        h1 {
            margin: 0 0 10px;
            font-weight: 600;
            font-size: 2.5rem;
            color: #0b1e33;
        }
        .subtitle {
            background: #e6edf5;
            padding: 12px 20px;
            border-radius: 60px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            border-left: 6px solid #2563eb;
        }
        .subtitle code {
            background: #d1d9e8;
            padding: 4px 10px;
            border-radius: 30px;
        }
        .expr-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        .expr-input {
            flex: 3;
            min-width: 280px;
        }
        .expr-input label {
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
        }
        .expr-row {
            display: flex;
            gap: 8px;
        }
        #exprInput {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #b9c7da;
            border-radius: 60px;
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            background: white;
        }
        #updateExpr {
            background: #1e2b3c;
            color: white;
            border: none;
            border-radius: 60px;
            padding: 0 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            border: 2px solid #1e2b3c;
        }
        #updateExpr:hover {
            background: #0f172a;
        }
        .examples {
            flex: 1;
            min-width: 200px;
        }
        .examples label {
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
        }
        .example-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .example-btn {
            background: #e2eaf2;
            border: 1px solid #a0b8d0;
            border-radius: 40px;
            padding: 8px 16px;
            font-weight: 500;
            cursor: pointer;
            flex: 1 0 auto;
        }
        .example-btn:hover {
            background: #cbd9e8;
        }
        .switches {
            background: #e2eaf2;
            border-radius: 80px;
            padding: 25px 30px;
            margin: 25px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
        }
        .switch-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .switch-item .var-name {
            font-size: 2rem;
            font-weight: 700;
        }
        .toggle-switch {
            width: 80px;
            height: 40px;
            background: #b0c0d0;
            border-radius: 40px;
            border: 3px solid #7e92a8;
            position: relative;
            cursor: pointer;
            transition: 0.2s;
        }
        .toggle-switch.active {
            background: #2ecc71;
            border-color: #1f8b4c;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .toggle-switch.active::after {
            left: 42px;
        }
        .state-label {
            font-weight: 600;
            background: #d3deed;
            padding: 4px 14px;
            border-radius: 40px;
        }
        .diagram-box {
            background: #0e1a2b;
            border-radius: 30px;
            padding: 25px;
            margin: 25px 0;
            color: white;
            overflow-x: auto;
        }
        .diagram-svg {
            display: block;
            margin: 0 auto;
            background: #102231;
            border-radius: 20px;
        }
        .output-area {
            background: #eef3f9;
            border-radius: 50px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 25px;
            margin-top: 20px;
            border: 2px solid #b0c7e0;
        }
        .led {
            width: 60px;
            height: 60px;
            border-radius: 60px;
            background: #b0c0d0;
            border: 4px solid #6f85a0;
            transition: 0.2s;
        }
        .led.on {
            background: #f7b731;
            border-color: #c47d0b;
            box-shadow: 0 0 25px #f39c12;
        }
        .output-value {
            font-size: 2.2rem;
            font-weight: 700;
        }
        .explain-box {
            background: #eef3f9;
            border-radius: 30px;
            padding: 25px;
            margin-top: 25px;
            border: 2px solid #b0c7e0;
        }
        .explain-box h3 {
            margin-top: 0;
        }
        .gate-detail {
            background: white;
            border-radius: 24px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-left: 10px solid #2563eb;
        }
        .gate-detail.active {
            border-left-color: #2ecc71;
            background: #eafaf1;
        }
        .wire-detail {
            display: inline-block;
            background: #d7e2f0;
            border-radius: 40px;
            padding: 5px 15px;
            margin: 4px 8px 4px 0;
            font-weight: 500;
        }
        .summary {
            background: #cfdeef;
            border-radius: 40px;
            padding: 15px 20px;
            font-weight: 500;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>‚ö° Portes l√≤giques IEC DIN ¬∑ Did√†ctic</h1>
    <div class="subtitle">
        <code> ! = NOT ¬∑ & = AND ¬∑ | = OR </code> 
        ‚Äî Prem sobre els interruptors i observa els valors
    </div>

    <!-- Expressi√≥ + exemples -->
    <div class="expr-panel">
        <div class="expr-input">
            <label>‚úèÔ∏è Expressi√≥ l√≤gica (f = ...)</label>
            <div class="expr-row">
                <input type="text" id="exprInput" value="(!a & b & c & !d) | (!a & d)">
                <button id="updateExpr">Generar</button>
            </div>
        </div>
        <div class="examples">
            <label>üìå Exemples r√†pids</label>
            <div class="example-btns">
                <button class="example-btn" data-expr="(!a & b & c & !d) | (!a & d)">1</button>
                <button class="example-btn" data-expr="a & b | c & !d">2</button>
                <button class="example-btn" data-expr="!(a & b)">3</button>
                <button class="example-btn" data-expr="a | b | c | !d">4</button>
            </div>
        </div>
    </div>

    <!-- Interruptors interactius -->
    <div class="switches">
        <div class="switch-item">
            <span class="var-name">a</span>
            <div class="toggle-switch" id="sw-a"></div>
            <span class="state-label" id="state-a">Obert</span>
        </div>
        <div class="switch-item">
            <span class="var-name">b</span>
            <div class="toggle-switch" id="sw-b"></div>
            <span class="state-label" id="state-b">Obert</span>
        </div>
        <div class="switch-item">
            <span class="var-name">c</span>
            <div class="toggle-switch" id="sw-c"></div>
            <span class="state-label" id="state-c">Obert</span>
        </div>
        <div class="switch-item">
            <span class="var-name">d</span>
            <div class="toggle-switch" id="sw-d"></div>
            <span class="state-label" id="state-d">Obert</span>
        </div>
    </div>

    <!-- Diagrama SVG (es genera amb JS) -->
    <div class="diagram-box" id="diagramContainer">
        <svg id="circuitSvg" class="diagram-svg" width="800" height="400" viewBox="0 0 800 400"></svg>
    </div>

    <!-- Sortida (LED) -->
    <div class="output-area">
        <div class="led" id="outputLed"></div>
        <div class="output-value" id="outputText">Sortida 0 (inactiva)</div>
    </div>

    <!-- Explicaci√≥ detallada -->
    <div class="explain-box" id="explainBox">
        <h3>üîç Raonament detallat</h3>
        <div id="explainContent"></div>
    </div>
</div>

<script>
    (function() {
        // --- Estat dels interruptors (false = obert / 0, true = tancat / 1)
        let estats = {
            a: false,
            b: false,
            c: false,
            d: false
        };

        // --- Elements del DOM
        const sw = {
            a: document.getElementById('sw-a'),
            b: document.getElementById('sw-b'),
            c: document.getElementById('sw-c'),
            d: document.getElementById('sw-d')
        };
        const stateLabel = {
            a: document.getElementById('state-a'),
            b: document.getElementById('state-b'),
            c: document.getElementById('state-c'),
            d: document.getElementById('state-d')
        };
        const exprInput = document.getElementById('exprInput');
        const updateBtn = document.getElementById('updateExpr');
        const svg = document.getElementById('circuitSvg');
        const outputLed = document.getElementById('outputLed');
        const outputText = document.getElementById('outputText');
        const explainContent = document.getElementById('explainContent');

        // --- Variables globals (estructura del circuit)
        let branques = [];            // llista de branques (cada branca = [ {var, type} ])
        let notGates = new Map();     // per cada variable negada, objecte { id, x, y, input, output }
        let andGates = [];            // llista de portes AND
        let orGate = null;            // porta OR final

        // --- Parseig de l'expressi√≥ (igual que abans)
        function parseExpression(expr) {
            expr = expr.replace(/\s/g, '');
            const parts = expr.split('|');
            return parts.map(part => {
                const factors = part.split('&');
                return factors.map(f => {
                    f = f.replace(/[()]/g, '');
                    if (f.startsWith('!')) {
                        return { var: f[1], type: 'NC' };   // NC = negat (NOT)
                    } else {
                        return { var: f, type: 'NO' };      // NO = directe
                    }
                });
            });
        }

        // --- Funci√≥ per obtenir el valor d'una variable
        function valorVar(v) {
            return estats[v] ? 1 : 0;
        }

        // --- Converteix l'estructura de branques a portes i calcula valors
        function calculaCircuits() {
            // Determinar quines variables necessiten NOT
            const varsNegades = new Set();
            branques.forEach(b => {
                b.forEach(c => {
                    if (c.type === 'NC') varsNegades.add(c.var);
                });
            });

            // Calcular valors de sortida de NOTs
            const notSortides = {};
            varsNegades.forEach(v => {
                notSortides[v] = valorVar(v) === 1 ? 0 : 1;
            });

            // Calcular sortides de les ANDs (cada branca)
            const andSortides = branques.map(b => {
                // la branca √©s certa si tots els literals s√≥n 1
                const val = b.every(c => {
                    if (c.type === 'NO') return valorVar(c.var) === 1;
                    else return valorVar(c.var) === 0; // NC
                }) ? 1 : 0;
                return val;
            });

            // Calcular sortida OR final
            const orSortida = andSortides.some(v => v === 1) ? 1 : 0;

            return { notSortides, andSortides, orSortida };
        }

        // --- Dibuixa el circuit SVG
        function dibuixaCircuit() {
            // Mida del SVG
            svg.setAttribute('width', 800);
            svg.setAttribute('height', 400);
            svg.setAttribute('viewBox', '0 0 800 400');
            svg.innerHTML = ''; // Netejar

            const { notSortides, andSortides, orSortida } = calculaCircuits();

            // Posicions predefinides
            const startX = 50;       // columna entrades
            const notX = 150;        // columna NOTs
            const andX = 300;        // columna ANDs
            const orX = 500;          // columna OR
            const outputX = 650;      // sortida

            const yPos = { a: 80, b: 140, c: 200, d: 260 }; // posicions verticals

            // Dibuixar entrades (interruptors) com a cercles amb text
            for (let v of ['a','b','c','d']) {
                const y = yPos[v];
                // cercle d'entrada
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', startX);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 12);
                circle.setAttribute('fill', estats[v] ? '#2ecc71' : '#e74c3c');
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', 2);
                svg.appendChild(circle);
                // text de la variable
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', startX - 20);
                text.setAttribute('y', y + 5);
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '16');
                text.setAttribute('font-weight', 'bold');
                text.textContent = v;
                svg.appendChild(text);
            }

            // Dibuixar NOTs (nom√©s per a les variables que apareixen negades)
            const varsNegades = new Set();
            branques.forEach(b => b.forEach(c => { if (c.type === 'NC') varsNegades.add(c.var); }));
            let notIndex = 0;
            for (let v of varsNegades) {
                const y = yPos[v];
                // rectangle NOT (IEC: rectangle amb "1" i cercle a la sortida)
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', notX - 20);
                rect.setAttribute('y', y - 15);
                rect.setAttribute('width', 40);
                rect.setAttribute('height', 30);
                rect.setAttribute('fill', '#334155');
                rect.setAttribute('stroke', 'white');
                rect.setAttribute('stroke-width', 2);
                svg.appendChild(rect);
                // text "1"
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', notX - 5);
                text.setAttribute('y', y + 5);
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '16');
                text.setAttribute('text-anchor', 'middle');
                text.textContent = '1';
                svg.appendChild(text);
                // cercle a la sortida (inversi√≥)
                const circleOut = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circleOut.setAttribute('cx', notX + 20);
                circleOut.setAttribute('cy', y);
                circleOut.setAttribute('r', 6);
                circleOut.setAttribute('fill', notSortides[v] ? '#2ecc71' : '#e74c3c');
                circleOut.setAttribute('stroke', 'white');
                svg.appendChild(circleOut);

                // l√≠nia d'entrada des de la variable
                const lineIn = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                lineIn.setAttribute('x1', startX + 12);
                lineIn.setAttribute('y1', y);
                lineIn.setAttribute('x2', notX - 20);
                lineIn.setAttribute('y2', y);
                lineIn.setAttribute('stroke', estats[v] ? '#2ecc71' : '#e74c3c');
                lineIn.setAttribute('stroke-width', 3);
                svg.appendChild(lineIn);

                notIndex++;
            }

            // Dibuixar ANDs (cada branca)
            const andYPositions = [];
            branques.forEach((branca, idx) => {
                // Determinar posici√≥ Y: centre entre les entrades implicades
                const varsInvolved = new Set();
                branca.forEach(c => varsInvolved.add(c.var));
                const ys = Array.from(varsInvolved).map(v => yPos[v]);
                const avgY = Math.round(ys.reduce((a,b) => a+b, 0) / ys.length);
                andYPositions[idx] = avgY;

                // Rectangle AND
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', andX - 25);
                rect.setAttribute('y', avgY - 20);
                rect.setAttribute('width', 50);
                rect.setAttribute('height', 40);
                rect.setAttribute('fill', andSortides[idx] ? '#0f3b1f' : '#334155');
                rect.setAttribute('stroke', 'white');
                rect.setAttribute('stroke-width', 2);
                svg.appendChild(rect);
                // text "&"
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', andX - 5);
                text.setAttribute('y', avgY + 5);
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '20');
                text.setAttribute('text-anchor', 'middle');
                text.textContent = '&';
                svg.appendChild(text);
                // cercle de sortida (opcional)
                const circleOut = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circleOut.setAttribute('cx', andX + 25);
                circleOut.setAttribute('cy', avgY);
                circleOut.setAttribute('r', 6);
                circleOut.setAttribute('fill', andSortides[idx] ? '#2ecc71' : '#e74c3c');
                circleOut.setAttribute('stroke', 'white');
                svg.appendChild(circleOut);

                // Dibuixar connexions d'entrada a aquesta AND
                branca.forEach(c => {
                    const v = c.var;
                    const ySrc = yPos[v];
                    // si la variable est√† negada, la font √©s la sortida del NOT (notX+20)
                    let xSrc, ySrcFinal = ySrc, color;
                    if (c.type === 'NC') {
                        xSrc = notX + 20;
                        color = notSortides[v] ? '#2ecc71' : '#e74c3c';
                    } else {
                        xSrc = startX + 12;
                        color = estats[v] ? '#2ecc71' : '#e74c3c';
                    }
                    // l√≠nia horitzontal fins a x = andX-25, despr√©s vertical?
                    // Simplificat: l√≠nia directa fins al rectangle (per√≤ potser creua altres). Per fer-ho senzill, dibuixem l√≠nia trencada: primer horitzontal fins just abans de la AND, despr√©s vertical fins a avgY.
                    const xBeforeAnd = andX - 25;
                    const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line1.setAttribute('x1', xSrc);
                    line1.setAttribute('y1', ySrcFinal);
                    line1.setAttribute('x2', xBeforeAnd);
                    line1.setAttribute('y2', ySrcFinal);
                    line1.setAttribute('stroke', color);
                    line1.setAttribute('stroke-width', 3);
                    svg.appendChild(line1);

                    const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line2.setAttribute('x1', xBeforeAnd);
                    line2.setAttribute('y1', ySrcFinal);
                    line2.setAttribute('x2', xBeforeAnd);
                    line2.setAttribute('y2', avgY);
                    line2.setAttribute('stroke', color);
                    line2.setAttribute('stroke-width', 3);
                    svg.appendChild(line2);
                });
            });

            // Dibuixar OR final
            if (branques.length > 0) {
                const orY = andYPositions.reduce((a,b) => a+b, 0) / andYPositions.length;
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', orX - 25);
                rect.setAttribute('y', orY - 20);
                rect.setAttribute('width', 50);
                rect.setAttribute('height', 40);
                rect.setAttribute('fill', orSortida ? '#0f3b1f' : '#334155');
                rect.setAttribute('stroke', 'white');
                rect.setAttribute('stroke-width', 2);
                svg.appendChild(rect);
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', orX - 5);
                text.setAttribute('y', orY + 5);
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '20');
                text.setAttribute('text-anchor', 'middle');
                text.textContent = '‚â•1';
                svg.appendChild(text);
                const circleOut = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circleOut.setAttribute('cx', orX + 25);
                circleOut.setAttribute('cy', orY);
                circleOut.setAttribute('r', 6);
                circleOut.setAttribute('fill', orSortida ? '#2ecc71' : '#e74c3c');
                circleOut.setAttribute('stroke', 'white');
                svg.appendChild(circleOut);

                // Connexions des de cada AND a l'OR
                andYPositions.forEach((yAnd, idx) => {
                    const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line1.setAttribute('x1', andX + 25);
                    line1.setAttribute('y1', yAnd);
                    line1.setAttribute('x2', orX - 25);
                    line1.setAttribute('y2', yAnd);
                    line1.setAttribute('stroke', andSortides[idx] ? '#2ecc71' : '#e74c3c');
                    line1.setAttribute('stroke-width', 3);
                    svg.appendChild(line1);
                    const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line2.setAttribute('x1', orX - 25);
                    line2.setAttribute('y1', yAnd);
                    line2.setAttribute('x2', orX - 25);
                    line2.setAttribute('y2', orY);
                    line2.setAttribute('stroke', andSortides[idx] ? '#2ecc71' : '#e74c3c');
                    line2.setAttribute('stroke-width', 3);
                    svg.appendChild(line2);
                });

                // Sortida final
                const lineOut = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                lineOut.setAttribute('x1', orX + 25);
                lineOut.setAttribute('y1', orY);
                lineOut.setAttribute('x2', outputX);
                lineOut.setAttribute('y2', orY);
                lineOut.setAttribute('stroke', orSortida ? '#2ecc71' : '#e74c3c');
                lineOut.setAttribute('stroke-width', 4);
                svg.appendChild(lineOut);
                // cercle final
                const circleFinal = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circleFinal.setAttribute('cx', outputX + 10);
                circleFinal.setAttribute('cy', orY);
                circleFinal.setAttribute('r', 10);
                circleFinal.setAttribute('fill', orSortida ? '#f7b731' : '#b0c0d0');
                circleFinal.setAttribute('stroke', 'white');
                svg.appendChild(circleFinal);
                const textF = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textF.setAttribute('x', outputX + 10);
                textF.setAttribute('y', orY - 15);
                textF.setAttribute('fill', 'white');
                textF.setAttribute('font-size', '14');
                textF.setAttribute('text-anchor', 'middle');
                textF.textContent = 'f';
                svg.appendChild(textF);
            }
        }

        // --- Genera explicaci√≥ detallada de les portes
        function generarExplicacio() {
            const { notSortides, andSortides, orSortida } = calculaCircuits();

            let html = '<div>';

            // Entrades
            html += '<div style="background:#d7e2f0; border-radius:40px; padding:10px 18px; margin-bottom:20px;">';
            html += '<strong>üìã Entrades:</strong> ';
            for (let v of ['a','b','c','d']) {
                html += `${v}=${estats[v] ? 1 : 0} `;
            }
            html += '</div>';

            // NOTs
            const varsNegades = new Set();
            branques.forEach(b => b.forEach(c => { if (c.type === 'NC') varsNegades.add(c.var); }));
            if (varsNegades.size > 0) {
                html += '<div style="margin-bottom:15px;"><strong>üîπ Portes NOT:</strong></div>';
                varsNegades.forEach(v => {
                    const sortida = notSortides[v];
                    html += `<div class="gate-detail ${sortida ? 'active' : ''}">`;
                    html += `NOT de ${v}: entrada = ${estats[v] ? 1 : 0} ‚Üí sortida = ${sortida} `;
                    html += `(perqu√® NOT nega l'entrada)</div>`;
                });
            }

            // ANDs
            html += '<div style="margin-top:15px; margin-bottom:15px;"><strong>üîπ Portes AND (productes):</strong></div>';
            branques.forEach((branca, idx) => {
                const sortida = andSortides[idx];
                let desc = branca.map(c => {
                    if (c.type === 'NO') return `${c.var}=${estats[c.var] ? 1 : 0}`;
                    else return `NOT ${c.var}=${estats[c.var] ? 1 : 0} ‚Üí ${notSortides[c.var]}`;
                }).join(', ');
                html += `<div class="gate-detail ${sortida ? 'active' : ''}">`;
                html += `AND${idx+1}: (${desc}) ‚Üí sortida = ${sortida} `;
                html += `(calen tots 1)</div>`;
            });

            // OR final
            html += '<div style="margin-top:15px;"><strong>üîπ Porta OR final:</strong></div>';
            html += `<div class="gate-detail ${orSortida ? 'active' : ''}">`;
            html += `OR: entrades = ${andSortides.join(', ')} ‚Üí sortida = ${orSortida} `;
            html += `(n'hi ha prou amb un 1)</div>`;

            // Resum
            html += `<div class="summary" style="margin-top:20px;">`;
            html += `<strong>üîå Resultat final:</strong> f = ${orSortida} ‚Üí `;
            html += orSortida ? 'SORTIDA ACTIVA (1)' : 'SORTIDA INACTIVA (0)';
            html += `</div>`;

            html += '</div>';
            return html;
        }

        // --- Actualitza tota la interf√≠cie
        function actualitzarTot() {
            // Actualitzar aspecte dels interruptors
            for (let lletra in estats) {
                if (estats[lletra]) {
                    sw[lletra].classList.add('active');
                    stateLabel[lletra].innerText = 'Tancat (1)';
                } else {
                    sw[lletra].classList.remove('active');
                    stateLabel[lletra].innerText = 'Obert (0)';
                }
            }

            // Dibuixar circuit
            dibuixaCircuit();

            // Actualitzar LED i text de sortida
            const { orSortida } = calculaCircuits();
            if (orSortida) {
                outputLed.classList.add('on');
                outputText.innerText = 'Sortida 1 (activa) ‚ö°';
            } else {
                outputLed.classList.remove('on');
                outputText.innerText = 'Sortida 0 (inactiva) ‚óã';
            }

            // Actualitzar explicaci√≥
            explainContent.innerHTML = generarExplicacio();
        }

        // --- Carregar nova expressi√≥
        function carregarExpressio(expr) {
            exprInput.value = expr;
            branques = parseExpression(expr);
            actualitzarTot();
        }

        // --- Assignar events
        for (let lletra in sw) {
            sw[lletra].addEventListener('click', () => {
                estats[lletra] = !estats[lletra];
                actualitzarTot();
            });
        }

        updateBtn.addEventListener('click', () => {
            carregarExpressio(exprInput.value);
        });

        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                const expr = e.target.getAttribute('data-expr');
                carregarExpressio(expr);
            });
        });

        // --- Inicialitzar
        branques = parseExpression(exprInput.value);
        actualitzarTot();
    })();
</script>
</body>
</html>















