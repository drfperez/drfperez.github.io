<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Farmacodinàmica</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2 {
            color: #333;
        }
        .slider-container {
            margin-bottom: 20px;
        }
        .slider {
            width: 100%;
        }
        #resultats {
            margin-top: 20px;
        }
        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Simulador de Farmacodinàmica</h1>
    
    <div class="slider-container">
        <label for="concentracio">Concentració del fàrmac (mg/L): <span id="concentracioValor"></span></label>
        <input type="range" id="concentracio" class="slider" min="0" max="100" step="0.1" value="50">
    </div>
    
    <div class="slider-container">
        <label for="emax">Efecte màxim (Emax): <span id="emaxValor"></span></label>
        <input type="range" id="emax" class="slider" min="0" max="100" step="1" value="100">
    </div>
    
    <div class="slider-container">
        <label for="ec50">Concentració que produeix el 50% de l'efecte màxim (EC50): <span id="ec50Valor"></span></label>
        <input type="range" id="ec50" class="slider" min="0" max="100" step="0.1" value="25">
    </div>
    
    <div class="slider-container">
        <label for="hillCoefficient">Coeficient de Hill: <span id="hillCoefficientValor"></span></label>
        <input type="range" id="hillCoefficient" class="slider" min="0.1" max="5" step="0.1" value="1">
    </div>
    
    <button onclick="calcular()">Calcular</button>
    
    <div id="resultats"></div>
    
    <canvas id="graficEfecte"></canvas>
    
    <script>
        let graficEfecte;
        
        function actualitzarValorsSliders() {
            document.getElementById('concentracioValor').textContent = document.getElementById('concentracio').value;
            document.getElementById('emaxValor').textContent = document.getElementById('emax').value;
            document.getElementById('ec50Valor').textContent = document.getElementById('ec50').value;
            document.getElementById('hillCoefficientValor').textContent = document.getElementById('hillCoefficient').value;
        }
        
        document.querySelectorAll('.slider').forEach(slider => {
            slider.addEventListener('input', actualitzarValorsSliders);
        });
        
        actualitzarValorsSliders();
        
        function calcular() {
            const concentracio = parseFloat(document.getElementById('concentracio').value);
            const emax = parseFloat(document.getElementById('emax').value);
            const ec50 = parseFloat(document.getElementById('ec50').value);
            const hillCoefficient = parseFloat(document.getElementById('hillCoefficient').value);
            
            const efecte = calcularEfecte(concentracio, emax, ec50, hillCoefficient);
            
            const resultatsDiv = document.getElementById('resultats');
            resultatsDiv.innerHTML = `
                <h2>Resultats:</h2>
                <p><strong>Pas 1:</strong> Càlcul de l'efecte utilitzant l'equació de Hill</p>
                <p><strong>Fórmula:</strong> E = (Emax * C^n) / (EC50^n + C^n)</p>
                <p>On:</p>
                <ul>
                    <li>E = Efecte</li>
                    <li>Emax = Efecte màxim (${emax})</li>
                    <li>C = Concentració del fàrmac (${concentracio} mg/L)</li>
                    <li>EC50 = Concentració que produeix el 50% de l'efecte màxim (${ec50} mg/L)</li>
                    <li>n = Coeficient de Hill (${hillCoefficient})</li>
                </ul>
                <p><strong>Pas 2:</strong> Substituïm els valors a l'equació</p>
                <p>E = (${emax} * ${concentracio}^${hillCoefficient}) / (${ec50}^${hillCoefficient} + ${concentracio}^${hillCoefficient})</p>
                <p><strong>Pas 3:</strong> Calculem el resultat</p>
                <p><strong>Efecte calculat:</strong> ${efecte.toFixed(2)}</p>
            `;
            
            actualitzarGrafic(emax, ec50, hillCoefficient);
        }
        
        function calcularEfecte(concentracio, emax, ec50, hillCoefficient) {
            return (emax * Math.pow(concentracio, hillCoefficient)) / (Math.pow(ec50, hillCoefficient) + Math.pow(concentracio, hillCoefficient));
        }
        
        function actualitzarGrafic(emax, ec50, hillCoefficient) {
            const concentracions = [];
            const efectes = [];
            
            for (let i = 0; i <= 100; i++) {
                concentracions.push(i);
                efectes.push(calcularEfecte(i, emax, ec50, hillCoefficient));
            }
            
            if (graficEfecte) {
                graficEfecte.destroy();
            }
            
            const ctx = document.getElementById('graficEfecte').getContext('2d');
            graficEfecte = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: concentracions,
                    datasets: [{
                        label: 'Efecte',
                        data: efectes,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Concentració del fàrmac (mg/L)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Efecte'
                            },
                            min: 0,
                            max: Math.max(...efectes) * 1.1
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>