<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>Simulador did√†ctic EXTRA ‚Äì Esquema de Contactes</title>
    <style>
        /* mateixos estils que abans, sense canvis */
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #eef2f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 40px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        h1 {
            margin: 0 0 10px;
            font-weight: 600;
            font-size: 2.5rem;
            color: #0b1e33;
        }
        .subtitle {
            background: #e6edf5;
            padding: 12px 20px;
            border-radius: 60px;
            margin-bottom: 25px;
            font-size: 1.1rem;
            border-left: 6px solid #2563eb;
        }
        .subtitle code {
            background: #d1d9e8;
            padding: 4px 10px;
            border-radius: 30px;
        }
        .expr-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        .expr-input {
            flex: 3;
            min-width: 280px;
        }
        .expr-input label {
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
        }
        .expr-row {
            display: flex;
            gap: 8px;
        }
        #exprInput {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #b9c7da;
            border-radius: 60px;
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            background: white;
        }
        #updateExpr {
            background: #1e2b3c;
            color: white;
            border: none;
            border-radius: 60px;
            padding: 0 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            border: 2px solid #1e2b3c;
        }
        #updateExpr:hover {
            background: #0f172a;
        }
        .examples {
            flex: 1;
            min-width: 200px;
        }
        .examples label {
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
        }
        .example-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .example-btn {
            background: #e2eaf2;
            border: 1px solid #a0b8d0;
            border-radius: 40px;
            padding: 8px 16px;
            font-weight: 500;
            cursor: pointer;
            flex: 1 0 auto;
        }
        .example-btn:hover {
            background: #cbd9e8;
        }
        .switches {
            background: #e2eaf2;
            border-radius: 80px;
            padding: 25px 30px;
            margin: 25px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 40px;
        }
        .switch-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .switch-item .var-name {
            font-size: 2rem;
            font-weight: 700;
        }
        .toggle-switch {
            width: 80px;
            height: 40px;
            background: #b0c0d0;
            border-radius: 40px;
            border: 3px solid #7e92a8;
            position: relative;
            cursor: pointer;
            transition: 0.2s;
        }
        .toggle-switch.active {
            background: #2ecc71;
            border-color: #1f8b4c;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 32px;
            height: 32px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .toggle-switch.active::after {
            left: 42px;
        }
        .state-label {
            font-weight: 600;
            background: #d3deed;
            padding: 4px 14px;
            border-radius: 40px;
        }
        .diagram-box {
            background: #0e1a2b;
            border-radius: 30px;
            padding: 25px;
            margin: 25px 0;
            color: white;
            overflow-x: auto;
        }
        .diagram-row {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 8px 0;
            border-radius: 30px;
            background: #1d314a;
        }
        .diagram-row.conducting {
            background: #0f3b1f;
            box-shadow: 0 0 0 2px #4cd964;
        }
        .rail-left, .rail-right {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffcc00;
            width: 50px;
            text-align: center;
        }
        .contacts {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            background: #102231;
            padding: 10px 20px;
            border-radius: 50px;
            margin: 0 10px;
        }
        .contact {
            display: inline-block;
            min-width: 70px;
            padding: 10px 14px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1.3rem;
            text-align: center;
            border: 3px solid;
            background: #1f3a57;
        }
        .contact.ok {
            border-color: #2ecc71;
            background: #116530;
            color: white;
        }
        .contact.bad {
            border-color: #e74c3c;
            background: #7b241c;
            color: #fadbd8;
        }
        .wire {
            font-size: 2rem;
            color: #8ba3c7;
        }
        .rail-line {
            flex: 1;
            height: 4px;
            background: #ffcc00;
            border-radius: 4px;
        }
        .output-area {
            background: #eef3f9;
            border-radius: 50px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            gap: 25px;
            margin-top: 20px;
            border: 2px solid #b0c7e0;
        }
        .led {
            width: 60px;
            height: 60px;
            border-radius: 60px;
            background: #b0c0d0;
            border: 4px solid #6f85a0;
            transition: 0.2s;
        }
        .led.on {
            background: #f7b731;
            border-color: #c47d0b;
            box-shadow: 0 0 25px #f39c12;
        }
        .output-value {
            font-size: 2.2rem;
            font-weight: 700;
        }
        .explain-box {
            background: #eef3f9;
            border-radius: 30px;
            padding: 25px;
            margin-top: 25px;
            border: 2px solid #b0c7e0;
        }
        .explain-box h3 {
            margin-top: 0;
        }
        .branch-detail {
            background: white;
            border-radius: 24px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-left: 10px solid #2563eb;
        }
        .branch-detail.conducting {
            border-left-color: #2ecc71;
            background: #eafaf1;
        }
        .contact-tag {
            display: inline-block;
            background: #d7e2f0;
            border-radius: 40px;
            padding: 5px 15px;
            margin: 4px 8px 4px 0;
            font-weight: 500;
        }
        .summary {
            background: #cfdeef;
            border-radius: 40px;
            padding: 15px 20px;
            font-weight: 500;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>‚ö° Esquema de Contactes ¬∑ Did√†ctic</h1>
    <div class="subtitle">
        <code> ! = NC (tancat en rep√≤s) ¬∑ & = s√®rie ¬∑ | = paral¬∑lel </code> 
        ‚Äî Prem sobre els interruptors i observa
    </div>

    <!-- Expressi√≥ + exemples -->
    <div class="expr-panel">
        <div class="expr-input">
            <label>‚úèÔ∏è Expressi√≥ l√≤gica (f = ...)</label>
            <div class="expr-row">
                <input type="text" id="exprInput" value="(!a & b & c & !d) | (!a & d)">
                <button id="updateExpr">Generar</button>
            </div>
        </div>
        <div class="examples">
            <label>üìå Exemples r√†pids</label>
            <div class="example-btns">
                <button class="example-btn" data-expr="(!a & b & c & !d) | (!a & d)">1</button>
                <button class="example-btn" data-expr="a & b | c & !d">2</button>
                <button class="example-btn" data-expr="!(a & b)">3</button>
                <button class="example-btn" data-expr="a | b | c | !d">4</button>
            </div>
        </div>
    </div>

    <!-- Interruptors interactius (switches) -->
    <div class="switches">
        <div class="switch-item">
            <span class="var-name">a</span>
            <div class="toggle-switch" id="sw-a"></div>
            <span class="state-label" id="state-a">Obert</span>
        </div>
        <div class="switch-item">
            <span class="var-name">b</span>
            <div class="toggle-switch" id="sw-b"></div>
            <span class="state-label" id="state-b">Obert</span>
        </div>
        <div class="switch-item">
            <span class="var-name">c</span>
            <div class="toggle-switch" id="sw-c"></div>
            <span class="state-label" id="state-c">Obert</span>
        </div>
        <div class="switch-item">
            <span class="var-name">d</span>
            <div class="toggle-switch" id="sw-d"></div>
            <span class="state-label" id="state-d">Obert</span>
        </div>
    </div>

    <!-- Diagrama (es pinta amb JS) -->
    <div class="diagram-box" id="diagramContainer">
        <div id="diagramContent"></div>
    </div>

    <!-- Sortida (LED) -->
    <div class="output-area">
        <div class="led" id="outputLed"></div>
        <div class="output-value" id="outputText">Sortida 0 (inactiva)</div>
    </div>

    <!-- Explicaci√≥ detallada -->
    <div class="explain-box" id="explainBox">
        <h3>üîç Raonament detallat</h3>
        <div id="explainContent"></div>
    </div>
</div>

<script>
    (function() {
        // --- Estat dels interruptors (tots oberts = false)
        let estats = {
            a: false,
            b: false,
            c: false,
            d: false
        };

        // --- Elements del DOM
        const sw = {
            a: document.getElementById('sw-a'),
            b: document.getElementById('sw-b'),
            c: document.getElementById('sw-c'),
            d: document.getElementById('sw-d')
        };
        const stateLabel = {
            a: document.getElementById('state-a'),
            b: document.getElementById('state-b'),
            c: document.getElementById('state-c'),
            d: document.getElementById('state-d')
        };
        const exprInput = document.getElementById('exprInput');
        const updateBtn = document.getElementById('updateExpr');
        const diagramContent = document.getElementById('diagramContent');
        const outputLed = document.getElementById('outputLed');
        const outputText = document.getElementById('outputText');
        const explainContent = document.getElementById('explainContent');

        // --- Variables globals
        let branques = [];  // array de branques, cada branca array de {var, type}

        // --- Parseig de l'expressi√≥ (senzill per√≤ suficient)
        function parseExpression(expr) {
            // Eliminar espais i par√®ntesis sobrants (per√≤ mantenint operadors)
            expr = expr.replace(/\s/g, '');
            // Dividir per | (paral¬∑lel)
            const parts = expr.split('|');
            return parts.map(part => {
                // Cada part √©s una conjunci√≥ (&)
                const factors = part.split('&');
                return factors.map(f => {
                    // Treiem possibles par√®ntesis individuals
                    f = f.replace(/[()]/g, '');
                    if (f.startsWith('!')) {
                        return { var: f[1], type: 'NC' };   // NC = normalment tancat
                    } else {
                        return { var: f, type: 'NO' };      // NO = normalment obert
                    }
                });
            });
        }

        // --- Comprova si un contacte condueix
        function contacteCondueix(contacte, estats) {
            return contacte.type === 'NO' ? estats[contacte.var] : !estats[contacte.var];
        }

        // --- Comprova si tota una branca condueix
        function brancaActiva(branca, estats) {
            return branca.every(c => contacteCondueix(c, estats));
        }

        // --- Genera el diagrama HTML
        function generarDiagrama(branques, estats) {
            const actives = branques.map(b => brancaActiva(b, estats));
            const hiHaCorrent = actives.some(v => v);

            let html = `
                <div style="display:flex; flex-direction:column; gap:12px;">
                <div style="display:flex; align-items:center; gap:5px;">
                    <span style="font-weight:bold; color:#ffcc00; width:50px;">L+</span>
                    <div style="flex:1; height:4px; background:#ffcc00; border-radius:4px;"></div>
                    <span style="padding:0 10px; color:white;">f</span>
                    <div style="flex:1; height:4px; background:#ffcc00; border-radius:4px;"></div>
                    <span style="font-weight:bold; color:#ffcc00; width:50px;">N-</span>
                </div>
            `;

            branques.forEach((branca, idx) => {
                const activa = actives[idx];
                const rowClass = activa ? 'diagram-row conducting' : 'diagram-row';
                html += `<div class="${rowClass}">`;
                html += `<span class="rail-left">|</span>`;

                html += `<div class="contacts">`;
                branca.forEach((c, i) => {
                    const condueix = contacteCondueix(c, estats);
                    const contactClass = condueix ? 'contact ok' : 'contact bad';
                    const simbol = c.type === 'NO' ? `[${c.var}]` : `[/${c.var}]`;
                    html += `<span class="${contactClass}">${simbol}</span>`;
                    if (i < branca.length - 1) {
                        html += `<span class="wire">‚îÄ</span>`;
                    }
                });
                html += `</div>`; // contacts

                html += `<span class="rail-right">|</span>`;
                html += `</div>`; // row
            });

            html += `
                <div style="display:flex; align-items:center; gap:5px;">
                    <span style="font-weight:bold; color:#ffcc00; width:50px;">L+</span>
                    <div style="flex:1; height:4px; background:#ffcc00; border-radius:4px;"></div>
                    <span style="padding:0 10px; color:white;">N-</span>
                    <div style="flex:1; height:4px; background:#ffcc00; border-radius:4px;"></div>
                    <span style="font-weight:bold; color:#ffcc00; width:50px;"></span>
                </div>
            </div>`;

            return html;
        }

        // --- Genera explicaci√≥ detallada (VERSI√ì CORREGIDA)
        function generarExplicacio(branques, estats) {
            const actives = branques.map(b => brancaActiva(b, estats));
            const algunaActiva = actives.some(v => v);

            let html = '';

            // Expressi√≥ en catal√†
            const exprNatural = branques.map((b, i) => {
                return b.map(c => {
                    if (c.type === 'NC') return `contacte NC de ${c.var} (tancat si ${c.var}=0)`;
                    else return `contacte NO de ${c.var} (tancat si ${c.var}=1)`;
                }).join(' i ');
            }).join('    O B√â    ');
            html += `<div style="background:#d7e2f0; border-radius:40px; padding:10px 18px; margin-bottom:20px;"><strong>üìã Condici√≥:</strong> ${exprNatural}</div>`;

            branques.forEach((branca, idx) => {
                const activa = actives[idx];
                // üëá AQUESTA √âS LA L√çNIA CORREGIDA (faltaven els : i les cometes)
                html += `<div class="branch-detail ${activa ? 'conducting' : ''}">`;
                html += `<strong style="font-size:1.3rem;">üîπ Branca ${idx+1}</strong> ‚Äî ${activa ? '‚úÖ CONDUEIX' : '‚ùå NO condueix'}<br>`;

                branca.forEach(c => {
                    const condueix = contacteCondueix(c, estats);
                    const estatReal = estats[c.var] ? 'tancat' : 'obert';
                    const tipusDesc = c.type === 'NO' ? 'NO (normalment obert)' : 'NC (normalment tancat)';
                    const estatContacte = condueix ? '‚úî passa corrent' : '‚úò bloqueja';
                    html += `<span class="contact-tag" style="background:${condueix ? '#b8f3c0' : '#fbc1c1'};">`;
                    html += `${c.var} (${tipusDesc}): realment est√† ${estatReal} ‚Üí ${estatContacte}`;
                    html += `</span><br>`;
                });
                html += `</div>`;
            });

            html += `<div class="summary">`;
            html += `<strong>üîå Resultat final:</strong> ${algunaActiva ? 'Hi ha un cam√≠ tancat ‚Üí Sortida ACTIVA (1)' : 'Cap cam√≠ tancat ‚Üí Sortida INACTIVA (0)'}.`;
            html += `</div>`;

            return html;
        }

        // --- Actualitza tota la interf√≠cie
        function actualitzarTot() {
            // Actualitzar aspecte dels interruptors
            for (let lletra in estats) {
                if (estats[lletra]) {
                    sw[lletra].classList.add('active');
                    stateLabel[lletra].innerText = 'Tancat';
                } else {
                    sw[lletra].classList.remove('active');
                    stateLabel[lletra].innerText = 'Obert';
                }
            }

            // Actualitzar diagrama
            diagramContent.innerHTML = generarDiagrama(branques, estats);

            // Actualitzar LED i text de sortida
            const hiHaCorrent = branques.some(b => brancaActiva(b, estats));
            if (hiHaCorrent) {
                outputLed.classList.add('on');
                outputText.innerText = 'Sortida 1 (activa) ‚ö°';
            } else {
                outputLed.classList.remove('on');
                outputText.innerText = 'Sortida 0 (inactiva) ‚óã';
            }

            // Actualitzar explicaci√≥
            explainContent.innerHTML = generarExplicacio(branques, estats);
        }

        // --- Carregar nova expressi√≥
        function carregarExpressio(expr) {
            exprInput.value = expr;
            branques = parseExpression(expr);
            actualitzarTot();
        }

        // --- Assignar events
        for (let lletra in sw) {
            sw[lletra].addEventListener('click', () => {
                estats[lletra] = !estats[lletra];
                actualitzarTot();
            });
        }

        updateBtn.addEventListener('click', () => {
            carregarExpressio(exprInput.value);
        });

        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                const expr = e.target.getAttribute('data-expr');
                carregarExpressio(expr);
            });
        });

        // --- Inicialitzar
        branques = parseExpression(exprInput.value);
        actualitzarTot();
    })();
</script>
</body>
</html>
